<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layout}">
<head>
    <title layout:fragment="title">Minyan Schedule - Admin</title>
    
    <th:block layout:fragment="styles">
        <style>
            .minyan-card {
                border-left: 4px solid var(--primary-color);
                transition: all 0.2s ease;
                margin-bottom: var(--spacing-4);
                padding: var(--spacing-4);
            }
            
            .minyan-card:hover {
                box-shadow: var(--shadow-md);
                transform: translateY(-2px);
            }
            
            .minyan-card.disabled {
                opacity: 0.6;
                border-left-color: var(--text-muted);
            }
            
            .minyan-header {
                display: flex;
                justify-content: space-between;
                align-items: start;
                margin-bottom: var(--spacing-3);
            }
            
            .minyan-location {
                font-size: var(--font-size-lg);
                font-weight: var(--font-weight-semibold);
                color: var(--text-primary);
                margin-bottom: var(--spacing-1);
            }
            
            .minyan-meta {
                display: flex;
                gap: var(--spacing-2);
                flex-wrap: wrap;
                margin-bottom: var(--spacing-3);
            }
            
            .minyan-badge {
                display: inline-flex;
                align-items: center;
                padding: var(--spacing-1) var(--spacing-2);
                background: var(--bg-secondary);
                border-radius: var(--border-radius);
                font-size: var(--font-size-sm);
                color: var(--text-secondary);
            }
            
            .minyan-badge i {
                margin-right: var(--spacing-1);
                font-size: 0.875em;
            }
            
            .schedule-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: var(--spacing-3);
                margin-bottom: var(--spacing-4);
            }
            
            .schedule-day {
                background: var(--bg-secondary);
                padding: var(--spacing-3);
                border-radius: var(--border-radius);
                text-align: center;
            }
            
            .schedule-day-name {
                font-size: var(--font-size-xs);
                text-transform: uppercase;
                font-weight: var(--font-weight-semibold);
                color: var(--text-muted);
                margin-bottom: var(--spacing-1);
                letter-spacing: 0.5px;
            }
            
            .schedule-time {
                font-size: var(--font-size-base);
                font-weight: var(--font-weight-medium);
                color: var(--text-primary);
            }
            
            .schedule-time.no-minyan {
                color: var(--text-muted);
                font-style: italic;
            }
            
            .special-days {
                border-top: 1px solid var(--border-color);
                padding-top: var(--spacing-3);
                margin-top: var(--spacing-2);
            }
            
            .special-days-label {
                font-size: var(--font-size-sm);
                font-weight: var(--font-weight-semibold);
                color: var(--text-secondary);
                margin-bottom: var(--spacing-2);
            }
            
            .minyan-actions {
                display: flex;
                gap: var(--spacing-2);
                flex-wrap: wrap;
            }
            
            .minyan-notes {
                background: var(--bg-tertiary);
                padding: var(--spacing-2);
                border-radius: var(--border-radius);
                font-size: var(--font-size-sm);
                color: var(--text-secondary);
                margin-top: var(--spacing-2);
                font-style: italic;
            }
            
            .filter-section {
                background: white;
                padding: var(--spacing-4);
                border-radius: var(--border-radius);
                box-shadow: var(--shadow-sm);
                margin-bottom: var(--spacing-5);
            }
            
            .sort-dropdown {
                display: flex;
                align-items: center;
                gap: var(--spacing-2);
                margin-bottom: var(--spacing-3);
            }
            
            .sort-dropdown label {
                font-weight: var(--font-weight-medium);
                color: var(--text-secondary);
                font-size: var(--font-size-sm);
            }
            
            .sort-dropdown select {
                padding: var(--spacing-2) var(--spacing-3);
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                font-size: var(--font-size-base);
                background: white;
                cursor: pointer;
            }
            
            .filter-tabs {
                display: flex;
                gap: var(--spacing-2);
                flex-wrap: wrap;
                margin-bottom: var(--spacing-3);
            }
            
            .filter-tab {
                padding: var(--spacing-2) var(--spacing-4);
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                cursor: pointer;
                transition: all 0.2s ease;
                font-weight: var(--font-weight-medium);
                color: var(--text-secondary);
            }
            
            .filter-tab:hover {
                background: var(--bg-tertiary);
                border-color: var(--primary-color);
            }
            
            .filter-tab.active {
                background: var(--primary-color);
                color: white;
                border-color: var(--primary-color);
            }
            
            .search-box {
                position: relative;
                margin-bottom: var(--spacing-3);
            }
            
            .search-box input {
                width: 100%;
                padding: var(--spacing-2) var(--spacing-3);
                padding-left: var(--spacing-5);
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius);
                font-size: var(--font-size-base);
            }
            
            .search-box i {
                position: absolute;
                left: var(--spacing-3);
                top: 50%;
                transform: translateY(-50%);
                color: var(--text-muted);
            }
            
            .empty-state {
                text-align: center;
                padding: var(--spacing-6) var(--spacing-4);
                background: var(--bg-secondary);
                border-radius: var(--border-radius);
            }
            
            .empty-state i {
                font-size: 3rem;
                color: var(--text-muted);
                margin-bottom: var(--spacing-3);
            }
            
            .empty-state h3 {
                color: var(--text-primary);
                margin-bottom: var(--spacing-2);
            }
            
            .stats-bar {
                display: flex;
                gap: var(--spacing-4);
                padding: var(--spacing-4);
                background: var(--bg-secondary);
                border-radius: var(--border-radius);
                margin-bottom: var(--spacing-5);
                flex-wrap: wrap;
            }
            
            .stat-item {
                display: flex;
                align-items: center;
                gap: var(--spacing-2);
            }
            
            .stat-item i {
                font-size: 1.5rem;
                color: var(--primary-color);
            }
            
            .stat-value {
                font-size: var(--font-size-xl);
                font-weight: var(--font-weight-bold);
                color: var(--text-primary);
            }
            
            .stat-label {
                font-size: var(--font-size-sm);
                color: var(--text-muted);
            }
            
            @media (max-width: 768px) {
                .schedule-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
                
                .filter-tabs {
                    flex-direction: column;
                }
                
                .filter-tab {
                    text-align: center;
                }
            }
        </style>
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <div class="page-header">
            <div>
                <h1 class="page-title">Minyan Schedule</h1>
                <p class="page-subtitle" th:text="|Manage minyanim for ${organization.name}|">Manage minyanim for your organization</p>
            </div>
            <div class="page-actions">
                <a th:href="@{'/admin/' + ${organization.id} + '/minyanim/printable'}" class="btn-modern btn-secondary">
                    <i class="fas fa-print"></i>
                    <span>Print Schedule</span>
                </a>
                <a th:href="@{'/admin/' + ${organization.id} + '/minyanim/new'}" class="btn-modern btn-primary">
                    <i class="fas fa-plus"></i>
                    <span>Add Minyan</span>
                </a>
            </div>
        </div>

        <!-- Statistics Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <i class="fas fa-calendar-check"></i>
                <div>
                    <div class="stat-value" th:text="${shacharisminyanim.size() + minchaminyanim.size() + maarivminyanim.size() + selichosminyanim.size() + megilaminyanim.size()}">0</div>
                    <div class="stat-label">Total Minyanim</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-sun"></i>
                <div>
                    <div class="stat-value" th:text="${shacharisminyanim.size()}">0</div>
                    <div class="stat-label">Shacharis</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-cloud-sun"></i>
                <div>
                    <div class="stat-value" th:text="${minchaminyanim.size()}">0</div>
                    <div class="stat-label">Mincha</div>
                </div>
            </div>
            <div class="stat-item">
                <i class="fas fa-moon"></i>
                <div>
                    <div class="stat-value" th:text="${maarivminyanim.size()}">0</div>
                    <div class="stat-label">Maariv</div>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="sort-dropdown">
                <label for="sortSelect">
                    <i class="fas fa-sort"></i> Sort by:
                </label>
                <select id="sortSelect" onchange="sortMinyanim()">
                    <option value="type">Prayer Type</option>
                    <option value="location">Location Name</option>
                    <option value="time">First Time (Sunday)</option>
                </select>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search by location, notes, or nusach..." />
            </div>
            
            <div class="filter-tabs">
                <button class="filter-tab active" data-type="all" onclick="filterMinyanim('all')">
                    <i class="fas fa-th-large"></i> All
                </button>
                <button class="filter-tab" data-type="shacharis" onclick="filterMinyanim('shacharis')">
                    <i class="fas fa-sun"></i> Shacharis
                </button>
                <button class="filter-tab" data-type="mincha" onclick="filterMinyanim('mincha')">
                    <i class="fas fa-cloud-sun"></i> Mincha
                </button>
                <button class="filter-tab" data-type="maariv" onclick="filterMinyanim('maariv')">
                    <i class="fas fa-moon"></i> Maariv
                </button>
                <button class="filter-tab" data-type="selichos" onclick="filterMinyanim('selichos')">
                    <i class="fas fa-praying-hands"></i> Selichos
                </button>
                <button class="filter-tab" data-type="megila" onclick="filterMinyanim('megila')">
                    <i class="fas fa-scroll"></i> Megila
                </button>
            </div>
        </div>

        <!-- Minyanim List -->
        <div id="minyanim-container">
            <!-- Shacharis Minyanim -->
            <div th:each="minyan: ${shacharisminyanim}" 
                 th:with="minyantimes=${shacharistimes.get(minyan.getId())}"
                 class="minyan-card card-modern"
                 th:classappend="${!minyan.isEnabled()} ? 'disabled' : ''"
                 data-type="shacharis"
                 data-sort-type="1"
                 th:attr="data-location=${locationnames.get(minyan.getId())}, data-nusach=${minyan.getNusach().displayName()}, data-notes=${minyan.getNotes()}, data-sort-time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY).displayTime()}">
                
                <div class="minyan-header">
                    <div>
                        <div class="minyan-location" th:text="${locationnames.get(minyan.getId())}">Location Name</div>
                        <div class="minyan-meta">
                            <span class="minyan-badge">
                                <i class="fas fa-sun"></i>
                                Shacharis
                            </span>
                            <span class="minyan-badge" th:text="${minyan.getNusach().displayName()}">Nusach</span>
                            <span class="minyan-badge" th:if="${!minyan.isEnabled()}">
                                <i class="fas fa-times-circle"></i>
                                Disabled
                            </span>
                        </div>
                    </div>
                    <div class="minyan-actions">
                        <a th:href="@{|/admin/minyanim/${minyan.getId()}/view|}" class="btn-modern btn-sm btn-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Update</span>
                        </a>
                        <a th:if="${minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/disable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-danger">
                            <i class="fas fa-times"></i>
                            <span>Disable</span>
                        </a>
                        <a th:if="${!minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/enable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-success">
                            <i class="fas fa-check"></i>
                            <span>Enable</span>
                        </a>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="schedule-grid">
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY)}">
                        <div class="schedule-day-name">Sunday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).MONDAY)}">
                        <div class="schedule-day-name">Monday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).TUESDAY)}">
                        <div class="schedule-day-name">Tuesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).WEDNESDAY)}">
                        <div class="schedule-day-name">Wednesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).THURSDAY)}">
                        <div class="schedule-day-name">Thursday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).FRIDAY)}">
                        <div class="schedule-day-name">Friday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SHABBOS)}">
                        <div class="schedule-day-name">Shabbos</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                </div>

                <!-- Special Days -->
                <div class="special-days">
                    <div class="special-days-label">Special Days</div>
                    <div class="schedule-grid">
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH)}">
                            <div class="schedule-day-name">Rosh Chodesh</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).YOM_TOV)}">
                            <div class="schedule-day-name">Yom Tov</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).CHANUKA)}">
                            <div class="schedule-day-name">Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH_CHANUKA)}">
                            <div class="schedule-day-name">R.C. Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                    </div>
                </div>

                <div th:if="${minyan.getNotes() != null and !minyan.getNotes().isEmpty()}" class="minyan-notes" th:text="${minyan.getNotes()}">
                    Notes about this minyan
                </div>
            </div>

            <!-- Mincha Minyanim -->
            <div th:each="minyan: ${minchaminyanim}" 
                 th:with="minyantimes=${minchatimes.get(minyan.getId())}"
                 class="minyan-card card-modern"
                 th:classappend="${!minyan.isEnabled()} ? 'disabled' : ''"
                 data-type="mincha"
                 data-sort-type="2"
                 th:attr="data-location=${locationnames.get(minyan.getId())}, data-nusach=${minyan.getNusach().displayName()}, data-notes=${minyan.getNotes()}, data-sort-time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY).displayTime()}">
                
                <div class="minyan-header">
                    <div>
                        <div class="minyan-location" th:text="${locationnames.get(minyan.getId())}">Location Name</div>
                        <div class="minyan-meta">
                            <span class="minyan-badge">
                                <i class="fas fa-cloud-sun"></i>
                                Mincha
                            </span>
                            <span class="minyan-badge" th:text="${minyan.getNusach().displayName()}">Nusach</span>
                            <span class="minyan-badge" th:if="${!minyan.isEnabled()}">
                                <i class="fas fa-times-circle"></i>
                                Disabled
                            </span>
                        </div>
                    </div>
                    <div class="minyan-actions">
                        <a th:href="@{|/admin/minyanim/${minyan.getId()}/view|}" class="btn-modern btn-sm btn-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Update</span>
                        </a>
                        <a th:if="${minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/disable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-danger">
                            <i class="fas fa-times"></i>
                            <span>Disable</span>
                        </a>
                        <a th:if="${!minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/enable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-success">
                            <i class="fas fa-check"></i>
                            <span>Enable</span>
                        </a>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="schedule-grid">
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY)}">
                        <div class="schedule-day-name">Sunday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).MONDAY)}">
                        <div class="schedule-day-name">Monday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).TUESDAY)}">
                        <div class="schedule-day-name">Tuesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).WEDNESDAY)}">
                        <div class="schedule-day-name">Wednesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).THURSDAY)}">
                        <div class="schedule-day-name">Thursday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).FRIDAY)}">
                        <div class="schedule-day-name">Friday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SHABBOS)}">
                        <div class="schedule-day-name">Shabbos</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                </div>

                <!-- Special Days -->
                <div class="special-days">
                    <div class="special-days-label">Special Days</div>
                    <div class="schedule-grid">
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH)}">
                            <div class="schedule-day-name">Rosh Chodesh</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).YOM_TOV)}">
                            <div class="schedule-day-name">Yom Tov</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).CHANUKA)}">
                            <div class="schedule-day-name">Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH_CHANUKA)}">
                            <div class="schedule-day-name">R.C. Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                    </div>
                </div>

                <div th:if="${minyan.getNotes() != null and !minyan.getNotes().isEmpty()}" class="minyan-notes" th:text="${minyan.getNotes()}">
                    Notes about this minyan
                </div>
            </div>

            <!-- Maariv Minyanim -->
            <div th:each="minyan: ${maarivminyanim}" 
                 th:with="minyantimes=${maarivtimes.get(minyan.getId())}"
                 class="minyan-card card-modern"
                 th:classappend="${!minyan.isEnabled()} ? 'disabled' : ''"
                 data-type="maariv"
                 data-sort-type="3"
                 th:attr="data-location=${locationnames.get(minyan.getId())}, data-nusach=${minyan.getNusach().displayName()}, data-notes=${minyan.getNotes()}, data-sort-time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY).displayTime()}">
                
                <div class="minyan-header">
                    <div>
                        <div class="minyan-location" th:text="${locationnames.get(minyan.getId())}">Location Name</div>
                        <div class="minyan-meta">
                            <span class="minyan-badge">
                                <i class="fas fa-moon"></i>
                                Maariv
                            </span>
                            <span class="minyan-badge" th:text="${minyan.getNusach().displayName()}">Nusach</span>
                            <span class="minyan-badge" th:if="${!minyan.isEnabled()}">
                                <i class="fas fa-times-circle"></i>
                                Disabled
                            </span>
                        </div>
                    </div>
                    <div class="minyan-actions">
                        <a th:href="@{|/admin/minyanim/${minyan.getId()}/view|}" class="btn-modern btn-sm btn-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Update</span>
                        </a>
                        <a th:if="${minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/disable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-danger">
                            <i class="fas fa-times"></i>
                            <span>Disable</span>
                        </a>
                        <a th:if="${!minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/enable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-success">
                            <i class="fas fa-check"></i>
                            <span>Enable</span>
                        </a>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="schedule-grid">
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY)}">
                        <div class="schedule-day-name">Sunday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).MONDAY)}">
                        <div class="schedule-day-name">Monday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).TUESDAY)}">
                        <div class="schedule-day-name">Tuesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).WEDNESDAY)}">
                        <div class="schedule-day-name">Wednesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).THURSDAY)}">
                        <div class="schedule-day-name">Thursday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).FRIDAY)}">
                        <div class="schedule-day-name">Friday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SHABBOS)}">
                        <div class="schedule-day-name">Shabbos</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                </div>

                <!-- Special Days -->
                <div class="special-days">
                    <div class="special-days-label">Special Days</div>
                    <div class="schedule-grid">
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH)}">
                            <div class="schedule-day-name">Rosh Chodesh</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).YOM_TOV)}">
                            <div class="schedule-day-name">Yom Tov</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).CHANUKA)}">
                            <div class="schedule-day-name">Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH_CHANUKA)}">
                            <div class="schedule-day-name">R.C. Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                    </div>
                </div>

                <div th:if="${minyan.getNotes() != null and !minyan.getNotes().isEmpty()}" class="minyan-notes" th:text="${minyan.getNotes()}">
                    Notes about this minyan
                </div>
            </div>

            <!-- Selichos Minyanim -->
            <div th:each="minyan: ${selichosminyanim}" 
                 th:with="minyantimes=${selichostimes.get(minyan.getId())}"
                 class="minyan-card card-modern"
                 th:classappend="${!minyan.isEnabled()} ? 'disabled' : ''"
                 data-type="selichos"
                 data-sort-type="4"
                 th:attr="data-location=${locationnames.get(minyan.getId())}, data-nusach=${minyan.getNusach().displayName()}, data-notes=${minyan.getNotes()}, data-sort-time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY).displayTime()}">
                
                <div class="minyan-header">
                    <div>
                        <div class="minyan-location" th:text="${locationnames.get(minyan.getId())}">Location Name</div>
                        <div class="minyan-meta">
                            <span class="minyan-badge">
                                <i class="fas fa-praying-hands"></i>
                                Selichos
                            </span>
                            <span class="minyan-badge" th:text="${minyan.getNusach().displayName()}">Nusach</span>
                            <span class="minyan-badge" th:if="${!minyan.isEnabled()}">
                                <i class="fas fa-times-circle"></i>
                                Disabled
                            </span>
                        </div>
                    </div>
                    <div class="minyan-actions">
                        <a th:href="@{|/admin/minyanim/${minyan.getId()}/view|}" class="btn-modern btn-sm btn-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Update</span>
                        </a>
                        <a th:if="${minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/disable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-danger">
                            <i class="fas fa-times"></i>
                            <span>Disable</span>
                        </a>
                        <a th:if="${!minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/enable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-success">
                            <i class="fas fa-check"></i>
                            <span>Enable</span>
                        </a>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="schedule-grid">
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY)}">
                        <div class="schedule-day-name">Sunday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).MONDAY)}">
                        <div class="schedule-day-name">Monday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).TUESDAY)}">
                        <div class="schedule-day-name">Tuesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).WEDNESDAY)}">
                        <div class="schedule-day-name">Wednesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).THURSDAY)}">
                        <div class="schedule-day-name">Thursday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).FRIDAY)}">
                        <div class="schedule-day-name">Friday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SHABBOS)}">
                        <div class="schedule-day-name">Shabbos</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                </div>

                <!-- Special Days -->
                <div class="special-days">
                    <div class="special-days-label">Special Days</div>
                    <div class="schedule-grid">
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH)}">
                            <div class="schedule-day-name">Rosh Chodesh</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).YOM_TOV)}">
                            <div class="schedule-day-name">Yom Tov</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).CHANUKA)}">
                            <div class="schedule-day-name">Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH_CHANUKA)}">
                            <div class="schedule-day-name">R.C. Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                    </div>
                </div>

                <div th:if="${minyan.getNotes() != null and !minyan.getNotes().isEmpty()}" class="minyan-notes" th:text="${minyan.getNotes()}">
                    Notes about this minyan
                </div>
            </div>

            <!-- Megila Minyanim -->
            <div th:each="minyan: ${megilaminyanim}" 
                 th:with="minyantimes=${megilatimes.get(minyan.getId())}"
                 class="minyan-card card-modern"
                 th:classappend="${!minyan.isEnabled()} ? 'disabled' : ''"
                 data-type="megila"
                 data-sort-type="5"
                 th:attr="data-location=${locationnames.get(minyan.getId())}, data-nusach=${minyan.getNusach().displayName()}, data-notes=${minyan.getNotes()}, data-sort-time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY).displayTime()}">
                
                <div class="minyan-header">
                    <div>
                        <div class="minyan-location" th:text="${locationnames.get(minyan.getId())}">Location Name</div>
                        <div class="minyan-meta">
                            <span class="minyan-badge">
                                <i class="fas fa-scroll"></i>
                                Megila Reading
                            </span>
                            <span class="minyan-badge" th:text="${minyan.getNusach().displayName()}">Nusach</span>
                            <span class="minyan-badge" th:if="${!minyan.isEnabled()}">
                                <i class="fas fa-times-circle"></i>
                                Disabled
                            </span>
                        </div>
                    </div>
                    <div class="minyan-actions">
                        <a th:href="@{|/admin/minyanim/${minyan.getId()}/view|}" class="btn-modern btn-sm btn-secondary">
                            <i class="fas fa-edit"></i>
                            <span>Update</span>
                        </a>
                        <a th:if="${minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/disable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-danger">
                            <i class="fas fa-times"></i>
                            <span>Disable</span>
                        </a>
                        <a th:if="${!minyan.isEnabled()}" 
                           th:href="@{|/admin/minyanim/${minyan.id}/enable|(rd=@{|/admin/${organization.id}/minyanim|})}"
                           class="btn-modern btn-sm btn-success">
                            <i class="fas fa-check"></i>
                            <span>Enable</span>
                        </a>
                    </div>
                </div>

                <!-- Weekly Schedule -->
                <div class="schedule-grid">
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SUNDAY)}">
                        <div class="schedule-day-name">Sunday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).MONDAY)}">
                        <div class="schedule-day-name">Monday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).TUESDAY)}">
                        <div class="schedule-day-name">Tuesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).WEDNESDAY)}">
                        <div class="schedule-day-name">Wednesday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).THURSDAY)}">
                        <div class="schedule-day-name">Thursday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).FRIDAY)}">
                        <div class="schedule-day-name">Friday</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                    <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).SHABBOS)}">
                        <div class="schedule-day-name">Shabbos</div>
                        <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                    </div>
                </div>

                <!-- Special Days -->
                <div class="special-days">
                    <div class="special-days-label">Special Days</div>
                    <div class="schedule-grid">
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH)}">
                            <div class="schedule-day-name">Rosh Chodesh</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).YOM_TOV)}">
                            <div class="schedule-day-name">Yom Tov</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).CHANUKA)}">
                            <div class="schedule-day-name">Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                        <div class="schedule-day" th:with="time=${minyantimes.get(T(com.tbdev.teaneckminyanim.minyan.MinyanDay).ROSH_CHODESH_CHANUKA)}">
                            <div class="schedule-day-name">R.C. Chanuka</div>
                            <div class="schedule-time" th:classappend="${time.displayTime() == 'No Minyan'} ? 'no-minyan' : ''" th:text="${time.displayTime()}">--</div>
                        </div>
                    </div>
                </div>

                <div th:if="${minyan.getNotes() != null and !minyan.getNotes().isEmpty()}" class="minyan-notes" th:text="${minyan.getNotes()}">
                    Notes about this minyan
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-calendar-times"></i>
                <h3>No minyanim found</h3>
                <p>Try adjusting your search or filter criteria</p>
            </div>
        </div>
    </div>

    <th:block layout:fragment="scripts">
        <script>
            let currentFilter = 'all';
            let currentSearch = '';
            
            // Sort functionality
            function sortMinyanim() {
                const sortBy = document.getElementById('sortSelect').value;
                const container = document.getElementById('minyanim-container');
                const cards = Array.from(document.querySelectorAll('.minyan-card'));
                
                // Remove empty state temporarily
                const emptyState = document.getElementById('emptyState');
                if (emptyState.parentNode === container) {
                    container.removeChild(emptyState);
                }
                
                // Sort cards
                cards.sort((a, b) => {
                    if (sortBy === 'type') {
                        return parseInt(a.dataset.sortType) - parseInt(b.dataset.sortType);
                    } else if (sortBy === 'location') {
                        const locA = (a.dataset.location || '').toLowerCase();
                        const locB = (b.dataset.location || '').toLowerCase();
                        return locA.localeCompare(locB);
                    } else if (sortBy === 'time') {
                        const timeA = a.dataset.sortTime || '';
                        const timeB = b.dataset.sortTime || '';
                        // Handle "No Minyan" case
                        if (timeA === 'No Minyan') return 1;
                        if (timeB === 'No Minyan') return -1;
                        return timeA.localeCompare(timeB);
                    }
                    return 0;
                });
                
                // Re-append sorted cards
                cards.forEach(card => container.appendChild(card));
                
                // Re-append empty state
                container.appendChild(emptyState);
                
                // Re-apply current filter and search
                applyFiltersAndSearch();
            }
            
            // Filter functionality
            function filterMinyanim(type) {
                currentFilter = type;
                
                // Update active tab
                document.querySelectorAll('.filter-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                event.target.closest('.filter-tab').classList.add('active');
                
                applyFiltersAndSearch();
            }
            
            // Apply both filters and search
            function applyFiltersAndSearch() {
                const cards = document.querySelectorAll('.minyan-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    // Check filter
                    const matchesFilter = currentFilter === 'all' || card.dataset.type === currentFilter;
                    
                    // Check search
                    const location = (card.dataset.location || '').toLowerCase();
                    const nusach = (card.dataset.nusach || '').toLowerCase();
                    const notes = (card.dataset.notes || '').toLowerCase();
                    const matchesSearch = currentSearch === '' || 
                                        location.includes(currentSearch) || 
                                        nusach.includes(currentSearch) || 
                                        notes.includes(currentSearch);
                    
                    // Show/hide based on both criteria
                    if (matchesFilter && matchesSearch) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Show empty state if no results
                document.getElementById('emptyState').style.display = visibleCount === 0 ? 'block' : 'none';
            }
            
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', function(e) {
                currentSearch = e.target.value.toLowerCase();
                applyFiltersAndSearch();
            });
            
            // Show toast for success/error messages
            [[${successmessage}]] && showToast('[[${successmessage}]]', 'success');
            [[${errormessage}]] && showToast('[[${errormessage}]]', 'error');
        </script>
    </th:block>
</body>
</html>
